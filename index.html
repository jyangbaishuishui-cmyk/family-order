<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ÂÆ∂Â∫≠ÁÇπÈ§êÂπ≥Âè∞</title>

    <!-- PWA: Web App Manifest -->
    <link rel="manifest" href="/family-order/manifest.json">

    <!-- PWA: ‰∏ªÂ±èÂπïÂõæÊ†áÔºàSafari ÂÖºÂÆπÔºâ -->
    <link rel="apple-touch-icon" href="/icon-192.png" />
    <meta name="apple-mobile-web-app-title" content="ÂÆ∂Â∫≠ÁÇπÈ§ê">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- PWA: Theme color for address bar -->
    <meta name="theme-color" content="#4facfe">

    <style>
        /* ‚Äî‚Äî‚Äî ‰Ω†ÁöÑÂéüÊúâ CSS ‚Äî‚Äî‚Äî */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
        }
        .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        .header p {
            font-size: 16px;
            opacity: 0.9;
            font-weight: 500;
        }
        .share-section {
            background: rgba(255,255,255,0.2);
            padding: 12px;
            border-radius: 12px;
            margin-top: 12px;
            display: flex;
            gap: 10px;
        }
        .share-input {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
        }
        .copy-btn {
            background: white;
            color: #4facfe;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .main-content {
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
        }
        .menu-section {
            flex: 3;
            min-width: 300px;
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .order-section {
            flex: 2;
            min-width: 280px;
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: sticky;
            top: 20px;
            height: fit-content;
        }
        .section-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #333;
            padding-bottom: 12px;
            border-bottom: 2px solid #f0f0f0;
        }
        .categories {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }
        .category-btn {
            padding: 10px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 20px;
            background: white;
            color: #666;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        .category-btn.active,
        .category-btn:hover {
            border-color: #4facfe;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        .food-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 20px;
        }
        .food-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            border: 2px solid #f8f9fa;
        }
        .food-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            border-color: #4facfe;
        }
        .food-image {
            width: 100%;
            height: 160px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
        }
        .food-info {
            padding: 16px;
        }
        .food-name {
            font-size: 18px;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
            line-height: 1.4;
        }
        .food-desc {
            font-size: 14px;
            color: #666;
            margin-bottom: 12px;
            min-height: 40px;
        }
        .food-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .food-price {
            font-size: 20px;
            font-weight: 700;
            color: #4facfe;
        }
        .add-to-cart {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .add-to-cart:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(79, 172, 254, 0.4);
        }
        .order-items {
            margin-bottom: 24px;
            max-height: 400px;
            overflow-y: auto;
        }
        .order-item {
            display: flex;
            align-items: center;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 12px;
            margin-bottom: 12px;
            border-left: 4px solid #4facfe;
        }
        .item-info {
            flex: 1;
            margin-right: 12px;
        }
        .item-name {
            font-weight: 600;
            font-size: 16px;
            color: #333;
            margin-bottom: 4px;
        }
        .item-price {
            font-size: 14px;
            color: #4facfe;
            font-weight: 500;
        }
        .item-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .control-btn {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            border: none;
            background: #4facfe;
            color: white;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        .control-btn.minus {
            background: #6c757d;
        }
        .control-btn:hover {
            transform: scale(1.1);
        }
        .quantity-display {
            min-width: 24px;
            text-align: center;
            font-weight: 600;
            font-size: 16px;
        }
        .total-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
        }
        .total-label {
            font-size: 16px;
            color: #666;
            margin-bottom: 8px;
            font-weight: 500;
        }
        .total-amount {
            font-size: 24px;
            font-weight: 700;
            color: #4facfe;
            background: white;
            padding: 12px 20px;
            border-radius: 12px;
            display: inline-block;
            min-width: 120px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .checkout-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }
        .checkout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(79, 172, 254, 0.3);
        }
        .checkout-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        .empty-state i {
            font-size: 48px;
            margin-bottom: 16px;
            color: #e9ecef;
            display: block;
        }
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        .clear-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .clear-btn:hover {
            background: #ee5a24;
        }
        .scrollbar {
            scrollbar-width: thin;
            scrollbar-color: #4facfe #f0f0f0;
        }
        .scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .scrollbar::-webkit-scrollbar-track {
            background: #f0f0f0;
            border-radius: 3px;
        }
        .scrollbar::-webkit-scrollbar-thumb {
            background: #4facfe;
            border-radius: 3px;
        }
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            .order-section {
                position: static;
            }
            .food-grid {
                grid-template-columns: 1fr;
            }
            .share-section {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçΩÔ∏è ÂÆ∂Â∫≠ÁÇπÈ§êÂπ≥Âè∞</h1>
            <p>ÂÆ∂‰∫∫‰ª¨ÂèØ‰ª•ÁÇπÈ§êÔºåËÆ¢Âçï‰ºöÁîüÊàêÂàÜ‰∫´ÈìæÊé•</p>
            <div class="share-section">
                <input type="text" id="shareUrl" class="share-input" placeholder="ËÆ¢ÂçïÂàÜ‰∫´ÈìæÊé•ÔºàÂ§çÂà∂ÂêéÂèëÈÄÅÁªôÂÆ∂‰∫∫Ôºâ" readonly>
                <button class="copy-btn" onclick="copyShareUrl()">Â§çÂà∂ÈìæÊé•</button>
            </div>
        </div>
        
        <div class="main-content">
            <div class="menu-section">
                <h2 class="section-title">üìã ËèúÂçï</h2>
                <div class="categories">
                    <button class="category-btn active">ÂÖ®ÈÉ®</button>
                    <button class="category-btn">‰∏ªÈ£ü</button>
                    <button class="category-btn">È•ÆÂìÅ</button>
                    <button class="category-btn">ÁîúÁÇπ</button>
                    <button class="category-btn">Â∞èÈ£ü</button>
                </div>
                <div class="food-grid" id="foodGrid"></div>
            </div>
            
            <div class="order-section">
                <div class="order-header">
                    <h2 class="section-title">üõí ÊàëÁöÑËÆ¢Âçï</h2>
                    <button class="clear-btn" onclick="clearOrder()" id="clearBtn">Ê∏ÖÁ©∫</button>
                </div>
                <div class="order-items scrollbar" id="orderItems">
                    <div class="empty-state">
                        <div>üõí</div>
                        <p>Ë¥≠Áâ©ËΩ¶‰∏∫Á©∫<br>ÈÄâÊã©ËèúÂìÅÂºÄÂßãÁÇπÈ§ê</p>
                    </div>
                </div>
                <div class="total-section">
                    <div class="total-label">ÊÄªËÆ°</div>
                    <div class="total-amount" id="totalAmount">0ÁßØÂàÜ</div>
                </div>
                <button class="checkout-btn" onclick="submitOrder()">Êèê‰∫§ËÆ¢Âçï</button>
            </div>
        </div>
    </div>

    <script>
        // PWA: Ê≥®ÂÜå Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').catch(err => {
                    console.log('Service Worker Ê≥®ÂÜåÂ§±Ë¥•:', err);
                });
            });
        }

        // ËèúÂçïÊï∞ÊçÆÔºà‰Ω†ÁöÑÂéüÊúâÈÄªËæëÔºâ
        const menuData = [
            { id: 1, name: "ÁªèÂÖ∏ÁâõËÇâÊ±âÂ†°", description: "100%Á∫ØÁâõËÇâÔºåÊñ∞È≤úËî¨ËèúÔºåÁâπÂà∂ÈÖ±Êñô", price: "25ÁßØÂàÜ", category: "‰∏ªÈ£ü", emoji: "üçî" },
            { id: 2, name: "È¶ôËÑÜÁÇ∏È∏°Â•óÈ§ê", description: "Â§ñÈÖ•ÈáåÂ´©ÁÇ∏È∏°ÔºåÊê≠ÈÖçËñØÊù°ÂíåÈ•ÆÊñô", price: "20ÁßØÂàÜ", category: "‰∏ªÈ£ü", emoji: "üçó" },
            { id: 3, name: "Â§èÂ®ÅÂ§∑Êä´Ëê®", description: "ÁÅ´ËÖø„ÄÅËè†Ëêù„ÄÅËäùÂ£´ÔºåÁæéÂë≥ÁªÑÂêà", price: "30ÁßØÂàÜ", category: "‰∏ªÈ£ü", emoji: "üçï" },
            { id: 4, name: "ÂÜ∞ÈïáÂèØ‰πê", description: "ÁªèÂÖ∏Á¢≥ÈÖ∏È•ÆÊñôÔºåÂÜ∞ÁàΩÁïÖÂø´", price: "8ÁßØÂàÜ", category: "È•ÆÂìÅ", emoji: "ü•§" },
            { id: 5, name: "È≤úÊ¶®Ê©ôÊ±Å", description: "100%Êñ∞È≤úÊ©ôÂ≠êÁé∞Ê¶®", price: "12ÁßØÂàÜ", category: "È•ÆÂìÅ", emoji: "üçπ" },
            { id: 6, name: "ÊäπËå∂ÊãøÈìÅ", description: "Êó•ÂºèÊäπËå∂‰∏éÁâõÂ•∂ÁöÑÂÆåÁæéËûçÂêà", price: "15ÁßØÂàÜ", category: "È•ÆÂìÅ", emoji: "üçµ" },
            { id: 7, name: "ÊèêÊãâÁ±≥Ëãè", description: "ÊÑèÂ§ßÂà©ÁªèÂÖ∏ÁîúÁÇπÔºåÂíñÂï°‰∏éÂ•∂È¶ô", price: "18ÁßØÂàÜ", category: "ÁîúÁÇπ", emoji: "üç∞" },
            { id: 8, name: "Â∑ßÂÖãÂäõÁÜîÂ≤©ËõãÁ≥ï", description: "ÁÉ≠Â∑ßÂÖãÂäõÊµÅÂøÉÔºåÊê≠ÈÖçÈ¶ôËçâÂÜ∞Ê∑áÊ∑ã", price: "22ÁßØÂàÜ", category: "ÁîúÁÇπ", emoji: "üç´" },
            { id: 9, name: "ËñØÊù°", description: "ÈáëÈªÑÈÖ•ËÑÜÔºåÊê≠ÈÖçÁâπÂà∂Áï™ËåÑÈÖ±", price: "10ÁßØÂàÜ", category: "Â∞èÈ£ü", emoji: "üçü" },
            { id: 10, name: "È∏°Á±≥Ëä±", description: "È¶ôËÑÜÂèØÂè£ÔºåÂ§öÁßçÂè£Âë≥ÂèØÈÄâ", price: "12ÁßØÂàÜ", category: "Â∞èÈ£ü", emoji: "üçó" },
            { id: 11, name: "Ëî¨ËèúÊ≤ôÊãâ", description: "Êñ∞È≤úÊó∂Ëî¨ÔºåÂÅ•Â∫∑ÁæéÂë≥", price: "15ÁßØÂàÜ", category: "Â∞èÈ£ü", emoji: "ü•ó" },
            { id: 12, name: "Ê∞¥ÊûúÊãºÁõò", description: "ÂΩìÂ≠£Êñ∞È≤úÊ∞¥ÊûúÔºåËê•ÂÖª‰∏∞ÂØå", price: "16ÁßØÂàÜ", category: "ÁîúÁÇπ", emoji: "üçì" }
        ];

        let currentOrder = [];

        // ‚Äî‚Äî‚Äî ‰ª•‰∏ãÊòØ‰Ω†ÂéüÊúâÁöÑ JS ÈÄªËæëÔºàÂ∑≤‰øùÁïôÔºâ‚Äî‚Äî‚Äî
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }
        function setUrlParameter(paramObj) {
            const url = new URL(window.location);
            Object.keys(paramObj).forEach(key => {
                if (paramObj[key]) {
                    url.searchParams.set(key, paramObj[key]);
                } else {
                    url.searchParams.delete(key);
                }
            });
            window.history.replaceState({}, '', url);
        }
        function loadOrderFromUrl() {
            const orderParam = getUrlParameter('order');
            if (orderParam) {
                try {
                    const decodedOrder = JSON.parse(decodeURIComponent(orderParam));
                    currentOrder = decodedOrder;
                } catch (e) {
                    console.error('Failed to parse order from URL', e);
                    currentOrder = [];
                }
            }
        }
        function updateUrlWithOrder() {
            if (currentOrder.length > 0) {
                const encodedOrder = encodeURIComponent(JSON.stringify(currentOrder));
                setUrlParameter({order: encodedOrder});
            } else {
                setUrlParameter({order: ''});
            }
            updateShareUrl();
        }
        function updateShareUrl() {
            const shareUrlInput = document.getElementById('shareUrl');
            shareUrlInput.value = window.location.href;
        }
        function initMenu() {
            renderFoodGrid(menuData);
            setupCategoryFilters();
            loadOrderFromUrl();
            updateOrderDisplay();
            updateShareUrl();
        }
        function renderFoodGrid(foods) {
            const foodGrid = document.getElementById('foodGrid');
            foodGrid.innerHTML = foods.map(food => `
                <div class="food-card">
                    <div class="food-image">${food.emoji}</div>
                    <div class="food-info">
                        <div class="food-name">${food.name}</div>
                        <div class="food-desc">${food.description}</div>
                        <div class="food-footer">
                            <div class="food-price">${food.price}</div>
                            <button class="add-to-cart" onclick="addToOrder(${food.id})">
                                <span>+</span> Âä†ÂÖ•
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        function setupCategoryFilters() {
            const categoryBtns = document.querySelectorAll('.category-btn');
            categoryBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    categoryBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const category = this.textContent;
                    if (category === 'ÂÖ®ÈÉ®') {
                        renderFoodGrid(menuData);
                    } else {
                        const filteredFoods = menuData.filter(food => food.category === category);
                        renderFoodGrid(filteredFoods);
                    }
                });
            });
        }
        function addToOrder(foodId) {
            const food = menuData.find(item => item.id === foodId);
            if (!food) return;
            const existingItem = currentOrder.find(item => item.id === foodId);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                currentOrder.push({ id: food.id, name: food.name, price: food.price, quantity: 1 });
            }
            updateOrderDisplay();
            updateUrlWithOrder();
        }
        function updateOrderQuantity(foodId, change) {
            const itemIndex = currentOrder.findIndex(item => item.id === foodId);
            if (itemIndex === -1) return;
            if (change === -1) {
                if (currentOrder[itemIndex].quantity > 1) {
                    currentOrder[itemIndex].quantity += change;
                } else {
                    currentOrder.splice(itemIndex, 1);
                }
            } else {
                currentOrder[itemIndex].quantity += change;
            }
            updateOrderDisplay();
            updateUrlWithOrder();
        }
        function updateOrderDisplay() {
            const orderItems = document.getElementById('orderItems');
            const totalAmount = document.getElementById('totalAmount');
            const clearBtn = document.getElementById('clearBtn');
            if (currentOrder.length === 0) {
                orderItems.innerHTML = `<div class="empty-state"><div>üõí</div><p>Ë¥≠Áâ©ËΩ¶‰∏∫Á©∫<br>ÈÄâÊã©ËèúÂìÅÂºÄÂßãÁÇπÈ§ê</p></div>`;
                totalAmount.textContent = '0ÁßØÂàÜ';
                clearBtn.style.display = 'none';
                return;
            }
            orderItems.innerHTML = currentOrder.map(item => `
                <div class="order-item">
                    <div class="item-info">
                        <div class="item-name">${item.name}</div>
                        <div class="item-price">${item.price}</div>
                    </div>
                    <div class="item-controls">
                        <button class="control-btn minus" onclick="updateOrderQuantity(${item.id}, -1)">-</button>
                        <span class="quantity-display">${item.quantity}</span>
                        <button class="control-btn" onclick="updateOrderQuantity(${item.id}, 1)">+</button>
                    </div>
                </div>
            `).join('');
            const priceCounts = {};
            currentOrder.forEach(item => {
                priceCounts[item.price] = (priceCounts[item.price] || 0) + item.quantity;
            });
            const priceEntries = Object.entries(priceCounts);
            if (priceEntries.length === 1) {
                totalAmount.textContent = `${priceEntries[0][1]}${priceEntries[0][0]}`;
            } else {
                const totalText = priceEntries.map(([price, count]) => `${count}${price}`).join(' + ');
                totalAmount.textContent = totalText.length > 20 ? totalText.substring(0, 20) + '...' : totalText;
            }
            clearBtn.style.display = 'block';
        }
        function clearOrder() {
            if (currentOrder.length === 0) return;
            if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâËÆ¢ÂçïÂêóÔºü')) {
                currentOrder = [];
                updateOrderDisplay();
                updateUrlWithOrder();
            }
        }
        function submitOrder() {
            if (currentOrder.length === 0) {
                alert('ËØ∑ÂÖàÈÄâÊã©ËèúÂìÅÔºÅ');
                return;
            }
            const orderSummary = currentOrder.map(item => 
                `${item.name} x${item.quantity} (${item.price})`
            ).join('\n');
            alert(`ËÆ¢ÂçïÂ∑≤Êèê‰∫§ÔºÅ\n\nÊÇ®ÁöÑËÆ¢ÂçïÔºö\n${orderSummary}\n\nÊÄªËÆ°Ôºö${document.getElementById('totalAmount').textContent}\n\nËØ∑Â∞Ü‰∏äÊñπÁöÑÂàÜ‰∫´ÈìæÊé•ÂèëÈÄÅÁªôÂÆ∂‰∫∫Êü•ÁúãËÆ¢ÂçïÔºÅ`);
        }
        function copyShareUrl() {
            const shareUrlInput = document.getElementById('shareUrl');
            shareUrlInput.select();
            try {
                document.execCommand('copy');
                alert('ÈìæÊé•Â∑≤Â§çÂà∂ÔºÅÁé∞Âú®ÂèØ‰ª•ÂèëÈÄÅÁªôÂÆ∂‰∫∫‰∫Ü„ÄÇ');
            } catch (err) {
                alert('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂ÈìæÊé•„ÄÇ');
            }
        }
        document.addEventListener('DOMContentLoaded', initMenu);
    </script>
</body>
</html>